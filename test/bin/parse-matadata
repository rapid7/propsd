#!/usr/bin/env node

/**
 * Parse the JSON document generated by get-metadata into a JSON document that the
 * Metadata Parser can grok.
 */

const FS = require('fs');
const Path = require('path');
const Util = require('../../lib/source/metadata/util');

const metadata = require('../data/metadata-paths.json');

Util.traverse(
  'latest',
  ['/meta-data/', '/dynamic/'],

  // Call `Metadata.request` for each path
  (path, cb) => cb(null, metadata[path]),

  // Handle results of metadata tree traversal
  (err, data) => {
    if (err) { throw err; }
    FS.writeFileSync(Path.resolve(__dirname, '../data/metadata-values.json'), JSON.stringify(data, null, 2));
  }
);
